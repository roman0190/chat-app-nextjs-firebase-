(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[929],{1173:function(e,t,s){Promise.resolve().then(s.bind(s,8712))},9553:function(e,t,s){"use strict";s.d(t,{Ap:function(){return u},I8:function(){return i},db:function(){return c},tO:function(){return o}});var a=s(5236),r=s(5735),n=s(9854),l=s(9842);let d=(0,a.ZF)({apiKey:"AIzaSyBEXMvVLB466qalKZdby8zbR6oXO0_wo1A",authDomain:"roman-apps.firebaseapp.com",databaseURL:"https://roman-apps-default-rtdb.firebaseio.com",projectId:"roman-apps",storageBucket:"roman-apps.appspot.com",messagingSenderId:"691534944125",appId:"1:691534944125:web:17a429186148bbe4639e14",measurementId:"G-26D4NX86NF"}),i=(0,r.v0)(d),o=(0,n.cF)(),c=(0,l.ad)(),u=new r.hJ;new r.O4("apple.com")},8712:function(e,t,s){"use strict";s.d(t,{default:function(){return N}});for(var a,r=s(7437),n=s(242),l=s(9553),d=s(5735),i=s(2265),o=s(9842),c=()=>{let[e,t]=(0,i.useState)(""),[s,a]=(0,i.useState)(null),[d,c]=(0,i.useState)(null),{user:u}=(0,i.useContext)(n.V),h=async()=>{let t=(0,o.hJ)(l.db,"users"),s=(0,o.IO)(t,(0,o.ar)("name","==",e));try{let e=await (0,o.PL)(s);e.empty?(a(null),c("No user found with that name")):e.forEach(e=>{a(e.data()),c(null)})}catch(e){c(e.message),a(null)}},m=async e=>{let r=u.uid>s.uid?u.uid+s.uid:s.uid+u.uid;try{let e=(0,o.JU)(l.db,"chats",r);if(console.log(r),!(await (0,o.QT)(e)).exists()){await (0,o.pl)(e,{messages:[]});let t=(0,o.JU)(l.db,"userChats",u.uid);await (0,o.r7)(t,{[r+".userInfo"]:{uid:s.uid,displayName:s.name,photoURL:s.photoURL},[r+".date"]:(0,o.Bt)()});let a=(0,o.JU)(l.db,"userChats",s.uid);await (0,o.r7)(a,{[r+".userInfo"]:{uid:u.uid,displayName:u.displayName,photoURL:u.photoURL},[r+".date"]:(0,o.Bt)()})}}catch(e){c(e)}a(null),t("")};return(0,r.jsxs)("div",{className:"searchbar flex flex-col mt-2",children:[(0,r.jsx)("input",{type:"text",placeholder:"Find a user",className:"bg-[#3C366B] p-1 rounded text-white placeholder-gray-400 focus:outline-none",onChange:e=>t(e.target.value),onKeyDown:e=>{"Enter"===e.code&&h()},value:e}),s?(0,r.jsxs)("div",{className:"searchUser flex mt-2 p-1 hover:bg-gray-600/30",onClick:m,children:[(0,r.jsx)("img",{src:s.photoURL,className:"w-12 h-12 rounded-full object-cover",alt:"User Profile"}),(0,r.jsx)("div",{className:"flex flex-col w-full justify-center ml-1",children:(0,r.jsx)("span",{children:s.name})})]}):d&&(0,r.jsx)("p",{className:"text-red-500",children:d}),(0,r.jsx)("hr",{className:"border-t border-gray-300 mt-2"})]})},u=s(7e3),h=()=>{var e;let[t,s]=(0,i.useState)({}),{user:a}=(0,i.useContext)(n.V),{dispatch:d}=(0,i.useContext)(u.p);(0,i.useEffect)(()=>{(null==a?void 0:a.uid)&&(()=>{let e=(0,o.cf)((0,o.JU)(l.db,"userChats",a.uid),e=>{s(e.data()||{})});return()=>{e()}})()},[null==a?void 0:a.uid]);let c=e=>{d({type:"CHANGE_USER",payload:e})};return(0,r.jsx)("div",{className:"allUser h-full overflow-y-scroll",children:null===(e=Object.entries(t))||void 0===e?void 0:e.sort((e,t)=>t[1].date-e[1].date).map(e=>{var t;return(0,r.jsxs)("div",{onClick:()=>c(e[1].userInfo),className:"user flex mt-2 p-1 hover:bg-gray-600/30 rounded-lg",children:[(0,r.jsx)("img",{src:e[1].userInfo.photoURL,className:"w-11 h-11 rounded-full object-cover",alt:e[1].userInfo.displayName}),(0,r.jsxs)("div",{className:"flex flex-col w-full justify-center ml-1",children:[(0,r.jsx)("span",{children:e[1].userInfo.displayName}),(0,r.jsx)("span",{className:"text-xs",children:null===(t=e[1].lastMessage)||void 0===t?void 0:t.text})]})]},e[0])})})},m=()=>{var e,t;let[s,a]=(0,i.useState)([]),{data:d}=(0,i.useContext)(u.p),{user:c}=(0,i.useContext)(n.V);return(0,i.useEffect)(()=>{if(!d.chatId)return;let e=(0,o.cf)((0,o.JU)(l.db,"chats",d.chatId),e=>{e.exists()&&a(e.data().messages||[])});return()=>{e()}},[d.chatId]),(0,r.jsx)(r.Fragment,{children:d.chatId?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:"chatNav flex items-center justify-between pl-2 bg-[#3C366B] h-[4.4rem] font-light",children:[(0,r.jsxs)("span",{className:"flex gap-2 items-center",children:[(0,r.jsx)("img",{src:null===(e=d.user)||void 0===e?void 0:e.photoURL,className:"w-10 h-10 rounded-full object-cover",alt:"User"}),null===(t=d.user)||void 0===t?void 0:t.displayName]}),(0,r.jsxs)("span",{className:"space-x-2",children:[(0,r.jsx)("i",{children:"icon"}),(0,r.jsx)("i",{children:"icon"}),(0,r.jsx)("i",{children:".."})]})]}),(0,r.jsx)("div",{className:"chat-container bg-slate-400 h-[86%] lg:h-[83%] md:h-[83%] p-2 flex flex-col overflow-y-auto",children:s.map(e=>(0,r.jsx)("div",{className:"messages flex flex-col h-full justify-end",children:(0,r.jsxs)("div",{className:"singleText flex ".concat(e.SenderId===c.uid?"flex-row-reverse":""," gap-2 mt-2"),children:[(0,r.jsx)("div",{className:"flex-shrink-0",children:(0,r.jsx)("img",{src:e.SenderId===c.uid?c.photoURL:d.user.photoURL,className:"w-9 h-9 rounded-full object-cover",alt:"Profile"})}),(0,r.jsxs)("div",{className:"bg-white rounded max-w-xs break-words overflow-hidden",children:[e.text&&(0,r.jsx)("div",{className:"bg-white text-black p-2",children:e.text}),e.img&&(0,r.jsx)("div",{children:(0,r.jsx)("img",{src:e.img,alt:"Sent image"})})]}),(0,r.jsx)("span",{className:"font-thin text-xs text-white self-end",children:new Date(1e3*e.date.seconds).toLocaleString("en-US",{hour:"numeric",minute:"numeric",hour12:!0,day:"numeric",month:"short",year:"numeric"})})]})},e.id))})]}):(0,r.jsx)("div",{className:"flex items-center justify-center h-full",children:(0,r.jsx)("span",{className:"text-gray-500",children:"Select a User to start messaging"})})})},x=s(9854),f={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)},p=new Uint8Array(16),g=[],v=0;v<256;++v)g.push((v+256).toString(16).slice(1));var j=function(e,t,s){if(f.randomUUID&&!t&&!e)return f.randomUUID();var r=(e=e||{}).random||(e.rng||function(){if(!a&&!(a="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)))throw Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return a(p)})();if(r[6]=15&r[6]|64,r[8]=63&r[8]|128,t){s=s||0;for(var n=0;n<16;++n)t[s+n]=r[n];return t}return function(e,t=0){return(g[e[t+0]]+g[e[t+1]]+g[e[t+2]]+g[e[t+3]]+"-"+g[e[t+4]]+g[e[t+5]]+"-"+g[e[t+6]]+g[e[t+7]]+"-"+g[e[t+8]]+g[e[t+9]]+"-"+g[e[t+10]]+g[e[t+11]]+g[e[t+12]]+g[e[t+13]]+g[e[t+14]]+g[e[t+15]]).toLowerCase()}(r)},b=()=>{let[e,t]=(0,i.useState)(""),[s,a]=(0,i.useState)(null),{user:d}=(0,i.useContext)(n.V),{data:c}=(0,i.useContext)(u.p),h=async()=>{if(s){let t=(0,x.iH)(l.tO,"images/".concat(j(),".png")),a=(0,x.B0)(t,s);a.on("state_changed",e=>{},e=>{},()=>{(0,x.Jt)(a.snapshot.ref).then(async t=>{await (0,o.r7)((0,o.JU)(l.db,"chats",c.chatId),{messages:(0,o.vr)({id:j(),text:e,SenderId:d.uid,date:o.EK.now(),img:t})})})})}else await (0,o.r7)((0,o.JU)(l.db,"chats",c.chatId),{messages:(0,o.vr)({id:j(),text:e,SenderId:d.uid,date:o.EK.now()})});await (0,o.r7)((0,o.JU)(l.db,"userChats",d.uid),{[c.chatId+".lastMessage"]:{text:e},[c.chatId+".date"]:(0,o.Bt)()}),await (0,o.r7)((0,o.JU)(l.db,"userChats",c.user.uid),{[c.chatId+".lastMessage"]:{text:e},[c.chatId+".date"]:(0,o.Bt)()}),a(null),t("")},m=e=>{"Enter"===e.code&&h()};return(0,r.jsxs)("div",{className:"inputSection flex bg-slate-500 h-[7vh] ",children:[(0,r.jsxs)("div",{className:"relative flex items-center w-full",children:[(0,r.jsx)("input",{onChange:e=>t(e.target.value),type:"text-area",placeholder:"Type something...",className:"bg-white w-full h-full p-2 pr-12 text-black",value:e,onKeyDown:m}),(0,r.jsx)("input",{type:"file",onChange:e=>a(e.target.files[0]),className:"hidden",id:"file","aria-label":"Upload file",onKeyDown:m}),(0,r.jsx)("label",{htmlFor:"file",className:"absolute right-2 cursor-pointer",children:(0,r.jsx)("img",{src:"/imgicon.png",className:"w-10 h-10",alt:"Upload icon"})})]}),(0,r.jsx)("button",{onClick:h,className:"w-16 bg-slate-700",children:"send"})]})},N=()=>{let{user:e}=(0,i.useContext)(n.V);return(0,r.jsxs)("div",{className:"flex border rounded-xl h-screen lg:h-[80vh] lg:w-[75rem] md:h-[80vh] md:w-[75rem] overflow-hidden",children:[(0,r.jsxs)("div",{className:"sidebar bg-[#3C366B] w-[50%]",children:[(0,r.jsxs)("div",{className:"sidebarNav flex justify-between pt-5 pb-5 bg-[#5f5a8a]",children:[(0,r.jsx)("span",{className:"text-xl font-bold ml-2 hidden md:flex lg:flex",children:"Chat"}),(0,r.jsxs)("span",{className:"flex gap-2 ",children:[(0,r.jsx)("img",{src:e.photoURL,className:"w-7 h-7 rounded-full object-cover",alt:""}),(0,r.jsx)("span",{className:"mt-1",children:e.displayName}),(0,r.jsx)("button",{onClick:()=>{(0,d.w7)(l.I8).then(()=>{window.location.href="/"}).catch(e=>{console.error("Sign out error:",e)})},className:" mr-2 p-1 text-sm border rounded-lg bg-[#393653]",children:"Logout"})]})]}),(0,r.jsx)(c,{}),(0,r.jsx)(h,{})]}),(0,r.jsxs)("div",{className:"chatSide bg-[#95939a] w-full",children:[(0,r.jsx)(m,{}),(0,r.jsx)(b,{})]})]})}},242:function(e,t,s){"use strict";s.d(t,{AuthContextProvider:function(){return o},V:function(){return d}});var a=s(7437),r=s(5735),n=s(2265),l=s(9553);let d=(0,n.createContext)(void 0),i={},o=e=>{let{children:t}=e,[s,o]=(0,n.useState)(i);return(0,n.useEffect)(()=>{let e=(0,r.Aj)(l.I8,e=>{o(e)});return()=>e()},[]),(0,a.jsx)(d.Provider,{value:{user:s},children:t})}},7e3:function(e,t,s){"use strict";s.d(t,{ChatContextProvider:function(){return d},p:function(){return l}});var a=s(7437),r=s(2265),n=s(242);let l=(0,r.createContext)(void 0),d=e=>{let{children:t}=e,{user:s}=(0,r.useContext)(n.V),[d,i]=(0,r.useReducer)((e,t)=>"CHANGE_USER"===t.type?{user:t.payload,chatId:s.uid>t.payload.uid?s.uid+t.payload.uid:t.payload.uid+s.uid}:e,{chatId:null,user:{}});return(0,a.jsx)(l.Provider,{value:{data:d,dispatch:i},children:t})}}},function(e){e.O(0,[358,605,712,971,23,744],function(){return e(e.s=1173)}),_N_E=e.O()}]);